openapi: 3.0.3
info:
  title: Designia Marketplace API
  description: |
    # Designia Marketplace API Documentation

    Complete API documentation for the Designia Marketplace platform.

    ## Overview
    The Marketplace API provides endpoints for:
    - **Product Catalog**: Browse, search, and manage products
    - **Shopping Cart**: Add items, update quantities, checkout
    - **Orders**: Create and manage orders
    - **Reviews**: Rate and review products
    - **Seller Management**: Seller profiles and analytics

    ## Authentication
    Most endpoints require JWT authentication. Include the token in the Authorization header:
    ```
    Authorization: Bearer <your-jwt-token>
    ```

    Public endpoints (no auth required):
    - Product listing and details
    - Category browsing
    - Product search
    - Seller profile viewing

    ## Rate Limiting
    Requests are rate-limited via Kong API Gateway:
    - **Public endpoints**: 100 requests/minute
    - **Authenticated endpoints**: 60 requests/minute
    - **Cart operations**: 60 requests/minute (bot prevention)

    ## Base URLs
    - **Production**: `https://api.designia.com/api/marketplace/`
    - **Staging**: `https://staging-api.designia.com/api/marketplace/`
    - **Development**: `http://localhost:8000/api/marketplace/`
    - **Via Kong Gateway**: `http://localhost:8000/api/marketplace/`

  version: 1.0.0
  contact:
    name: Designia API Support
    email: api-support@designia.com
  license:
    name: Proprietary

servers:
  - url: http://localhost:8000/api/marketplace
    description: Development (Direct Django)
  - url: http://localhost:8000/api/marketplace
    description: Development (Kong Gateway)
  - url: https://api.designia.com/api/marketplace
    description: Production

security:
  - Bearer: []

tags:
  - name: Products
    description: Product catalog operations (CRUD, search, filtering)
  - name: Categories
    description: Product category management
  - name: Cart
    description: Shopping cart operations
  - name: Orders
    description: Order lifecycle management
  - name: Reviews
    description: Product reviews and ratings
  - name: Search
    description: Advanced product search and filtering
  - name: Seller
    description: Seller profile and analytics
  - name: Metrics
    description: Product metrics and analytics
  - name: Internal
    description: Internal service-to-service APIs (not exposed publicly)

paths:
  # ====================
  # PRODUCTS
  # ====================
  /products/:
    get:
      tags: [Products]
      summary: List all products
      description: |
        Retrieve a paginated list of products with optional filtering.

        **Public endpoint** - No authentication required.
      operationId: listProducts
      security: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Page number
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
          description: Items per page (max 100)
        - name: category
          in: query
          schema:
            type: string
          description: Filter by category slug
          example: electronics
        - name: seller
          in: query
          schema:
            type: integer
          description: Filter by seller user ID
        - name: price_min
          in: query
          schema:
            type: number
            format: decimal
          description: Minimum price filter
        - name: price_max
          in: query
          schema:
            type: number
            format: decimal
          description: Maximum price filter
        - name: condition
          in: query
          schema:
            type: string
            enum: [new, like_new, used, refurbished]
          description: Product condition filter
        - name: brand
          in: query
          schema:
            type: string
          description: Filter by brand (case-insensitive contains)
        - name: in_stock
          in: query
          schema:
            type: boolean
          description: Show only in-stock products
        - name: is_featured
          in: query
          schema:
            type: boolean
          description: Show only featured products
        - name: ordering
          in: query
          schema:
            type: string
            enum: [-created_at, created_at, price, -price, -view_count, -favorite_count]
            default: -created_at
          description: Sort order
      responses:
        '200':
          description: Successfully retrieved product list
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    description: Total number of products
                  page:
                    type: integer
                  page_size:
                    type: integer
                  num_pages:
                    type: integer
                  has_next:
                    type: boolean
                  has_previous:
                    type: boolean
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProductList'
        '500':
          $ref: '#/components/responses/InternalError'

    post:
      tags: [Products]
      summary: Create a new product
      description: |
        Create a new product listing. Seller role required.

        **Authentication required** - Must be a verified seller.
      operationId: createProduct
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetail'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: User is not a verified seller
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                detail: "User is not a seller"

  /products/{slug}/:
    get:
      tags: [Products]
      summary: Get product details
      description: |
        Retrieve detailed information about a specific product.

        **Public endpoint** - No authentication required.
        View count is incremented on each access.
      operationId: getProduct
      security: []
      parameters:
        - $ref: '#/components/parameters/ProductSlug'
      responses:
        '200':
          description: Product details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetail'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Products]
      summary: Update product
      description: Update an existing product. Only the product owner can update.
      operationId: updateProduct
      parameters:
        - $ref: '#/components/parameters/ProductSlug'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUpdate'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetail'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Not the product owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                detail: "You do not own this product"
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags: [Products]
      summary: Partially update product
      description: Partially update a product. Only the product owner can update.
      operationId: partialUpdateProduct
      parameters:
        - $ref: '#/components/parameters/ProductSlug'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductUpdate'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetail'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Products]
      summary: Delete product
      description: |
        Delete a product (soft delete by default).
        Only the product owner can delete their products.
      operationId: deleteProduct
      parameters:
        - $ref: '#/components/parameters/ProductSlug'
      responses:
        '204':
          description: Product deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'

  # ====================
  # SEARCH
  # ====================
  /products/search/:
    get:
      tags: [Search]
      summary: Search products
      description: |
        Full-text search across products by name, description, brand, and tags.

        **Public endpoint** - No authentication required.
      operationId: searchProducts
      security: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
          description: Search query
          example: "iPhone 15"
        - name: category
          in: query
          schema:
            type: string
          description: Filter by category slug
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
          description: Maximum results
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProductList'
        '400':
          $ref: '#/components/responses/ValidationError'

  /products/autocomplete/:
    get:
      tags: [Search]
      summary: Autocomplete search suggestions
      description: Get product name suggestions for autocomplete
      operationId: autocompleteProducts
      security: []
      parameters:
        - name: q
          in: query
          required: true
          schema:
            type: string
            minLength: 2
          description: Search prefix
          example: "iPh"
      responses:
        '200':
          description: Autocomplete suggestions
          content:
            application/json:
              schema:
                type: object
                properties:
                  suggestions:
                    type: array
                    items:
                      type: string
                    example: ["iPhone 15", "iPhone 14", "iPhone 13"]

  /products/filters/:
    get:
      tags: [Search]
      summary: Get available filter options
      description: Get all available filter options (brands, categories, price ranges)
      operationId: getProductFilters
      security: []
      responses:
        '200':
          description: Available filter options
          content:
            application/json:
              schema:
                type: object
                properties:
                  brands:
                    type: array
                    items:
                      type: string
                  categories:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        name:
                          type: string
                        slug:
                          type: string
                  price_range:
                    type: object
                    properties:
                      min:
                        type: number
                      max:
                        type: number

  # ====================
  # CATEGORIES
  # ====================
  /categories/:
    get:
      tags: [Categories]
      summary: List all categories
      description: Get all product categories
      operationId: listCategories
      security: []
      responses:
        '200':
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /categories/{id}/:
    get:
      tags: [Categories]
      summary: Get category details
      description: Get a specific category with product count
      operationId: getCategory
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Category details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '404':
          $ref: '#/components/responses/NotFound'

  # ====================
  # CART
  # ====================
  /cart/:
    get:
      tags: [Cart]
      summary: Get user's cart
      description: Retrieve the current user's shopping cart
      operationId: getCart
      responses:
        '200':
          description: Cart retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '401':
          $ref: '#/components/responses/Unauthorized'

    delete:
      tags: [Cart]
      summary: Clear cart
      description: Remove all items from the cart
      operationId: clearCart
      responses:
        '204':
          description: Cart cleared successfully
        '401':
          $ref: '#/components/responses/Unauthorized'

  /cart/add/:
    post:
      tags: [Cart]
      summary: Add item to cart
      description: |
        Add a product to the shopping cart.

        **Rate limited** to 60 requests/minute to prevent bot abuse.
      operationId: addToCart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [product_id, quantity]
              properties:
                product_id:
                  type: string
                  format: uuid
                  description: Product UUID
                quantity:
                  type: integer
                  minimum: 1
                  default: 1
              example:
                product_id: "123e4567-e89b-12d3-a456-426614174000"
                quantity: 2
      responses:
        '200':
          description: Item added to cart
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '400':
          description: Validation error (out of stock, invalid product)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                detail: "Too many requests. Please try again later."

  /cart/update/:
    put:
      tags: [Cart]
      summary: Update cart item quantity
      description: Update the quantity of an item in the cart
      operationId: updateCartItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [product_id, quantity]
              properties:
                product_id:
                  type: string
                  format: uuid
                quantity:
                  type: integer
                  minimum: 0
                  description: Set to 0 to remove item
      responses:
        '200':
          description: Cart updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /cart/remove/:
    delete:
      tags: [Cart]
      summary: Remove item from cart
      description: Remove a specific item from the cart
      operationId: removeFromCart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [product_id]
              properties:
                product_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: Item removed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /cart/validate/:
    get:
      tags: [Cart]
      summary: Validate cart
      description: |
        Check cart for issues before checkout:
        - Out of stock items
        - Inactive products
        - Price changes
      operationId: validateCart
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                  issues:
                    type: array
                    items:
                      type: object
                      properties:
                        product_id:
                          type: string
                        issue_type:
                          type: string
                          enum: [out_of_stock, inactive, price_changed]
                        message:
                          type: string
        '401':
          $ref: '#/components/responses/Unauthorized'

  # ====================
  # ORDERS
  # ====================
  /orders/:
    get:
      tags: [Orders]
      summary: List user's orders
      description: Get all orders for the current user
      operationId: listOrders
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending_payment, payment_confirmed, awaiting_shipment, shipped, delivered, cancelled, refunded]
          description: Filter by order status
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Orders retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                  page:
                    type: integer
                  page_size:
                    type: integer
                  num_pages:
                    type: integer
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags: [Orders]
      summary: Create order from cart
      description: |
        Create an order from the current cart contents.

        **Process:**
        1. Validates cart (stock, active products)
        2. Reserves inventory
        3. Calculates totals (subtotal, shipping, tax)
        4. Creates order with status "pending_payment"
        5. Clears cart
        6. Publishes OrderPlacedEvent
      operationId: createOrder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [shipping_address]
              properties:
                shipping_address:
                  type: object
                  required: [street, city, state, postal_code, country]
                  properties:
                    street:
                      type: string
                    city:
                      type: string
                    state:
                      type: string
                    postal_code:
                      type: string
                    country:
                      type: string
                buyer_notes:
                  type: string
                  description: Optional notes for seller
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Cart validation failed or insufficient stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                cartEmpty:
                  value:
                    error: "cart_empty"
                    message: "Cannot create order from empty cart"
                outOfStock:
                  value:
                    error: "reservation_failed"
                    message: "Failed to reserve stock for iPhone 15: Insufficient stock"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /orders/{id}/:
    get:
      tags: [Orders]
      summary: Get order details
      description: Get detailed information about a specific order (owner only)
      operationId: getOrder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetail'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Not the order owner
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          $ref: '#/components/responses/NotFound'

  /orders/{id}/cancel/:
    post:
      tags: [Orders]
      summary: Cancel order
      description: |
        Cancel an order before shipment. Releases inventory back to stock.

        Can only cancel orders in status: pending_payment, payment_confirmed, awaiting_shipment
      operationId: cancelOrder
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  description: Cancellation reason
      responses:
        '200':
          description: Order cancelled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Cannot cancel order in current status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                error: "order_cannot_cancel"
                message: "Cannot cancel order in status 'shipped'"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'

  # ====================
  # REVIEWS
  # ====================
  /reviews/:
    get:
      tags: [Reviews]
      summary: List reviews
      description: Get product reviews (can filter by product)
      operationId: listReviews
      security: []
      parameters:
        - name: product
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by product ID
      responses:
        '200':
          description: Reviews retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Review'

    post:
      tags: [Reviews]
      summary: Create review
      description: |
        Create a product review.

        **Requirements:**
        - Must have purchased the product
        - One review per product per user
      operationId: createReview
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewCreate'
      responses:
        '201':
          description: Review created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Review'
        '400':
          description: Validation error or duplicate review
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /reviews/{id}/:
    get:
      tags: [Reviews]
      summary: Get review details
      operationId: getReview
      security: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Review details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Review'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Reviews]
      summary: Update review
      description: Update your own review (owner only)
      operationId: updateReview
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReviewCreate'
      responses:
        '200':
          description: Review updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Review'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [Reviews]
      summary: Delete review
      description: Delete your own review (owner only)
      operationId: deleteReview
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Review deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'

  # ====================
  # SELLER
  # ====================
  /sellers/{seller_id}/:
    get:
      tags: [Seller]
      summary: Get seller profile
      description: Get public seller profile information
      operationId: getSellerProfile
      security: []
      parameters:
        - name: seller_id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Seller profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SellerProfile'
        '404':
          $ref: '#/components/responses/NotFound'

  # ====================
  # METRICS (Internal/Admin)
  # ====================
  /metrics/:
    get:
      tags: [Metrics]
      summary: Get Prometheus metrics
      description: |
        Expose Prometheus metrics for the marketplace.

        **Metrics include:**
        - `marketplace_orders_placed_total` - Total orders (by status)
        - `marketplace_order_value` - Order value histogram
        - `marketplace_stock_reservation_failure` - Stock failures
        - `marketplace_internal_api_calls_total` - Internal API calls
      operationId: getMetrics
      security: []
      responses:
        '200':
          description: Prometheus metrics in text format
          content:
            text/plain:
              schema:
                type: string
              example: |
                # HELP marketplace_orders_placed_total Total orders placed
                # TYPE marketplace_orders_placed_total counter
                marketplace_orders_placed_total{status="success"} 42
                marketplace_orders_placed_total{status="failure"} 3

  # ====================
  # INTERNAL APIs
  # ====================
  /internal/products/{product_id}/:
    get:
      tags: [Internal]
      summary: Internal - Get product info
      description: |
        **Internal API** for service-to-service communication.

        Returns minimal product data for other services (e.g., Payment, Notification).

        **Security:** Should only be accessible within internal network.
        Not exposed through Kong Gateway to public.
      operationId: internalGetProduct
      security: []
      parameters:
        - name: product_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Product info
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  name:
                    type: string
                  price:
                    type: string
                  stock_quantity:
                    type: integer
                  is_active:
                    type: boolean
                  seller_id:
                    type: integer
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /internal/orders/{order_id}/:
    get:
      tags: [Internal]
      summary: Internal - Get order info
      description: |
        **Internal API** for service-to-service communication.

        Returns order data for other services (e.g., Payment webhook processing).

        **Security:** Should only be accessible within internal network.
      operationId: internalGetOrder
      security: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Order info
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  status:
                    type: string
                  total_amount:
                    type: string
                  buyer_id:
                    type: integer
                  payment_status:
                    type: string
                  created_at:
                    type: string
                    format: date-time
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

# ====================
# COMPONENTS
# ====================
components:
  securitySchemes:
    Bearer:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from `/api/auth/login` endpoint.

        Include in Authorization header: `Authorization: Bearer <token>`

  parameters:
    ProductSlug:
      name: slug
      in: path
      required: true
      schema:
        type: string
      description: Product slug (URL-friendly identifier)
      example: iphone-15-pro-max

  schemas:
    # ====================
    # PRODUCT SCHEMAS
    # ====================
    ProductList:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        slug:
          type: string
        short_description:
          type: string
        price:
          type: string
          format: decimal
        original_price:
          type: string
          format: decimal
          nullable: true
        discount_percentage:
          type: number
          nullable: true
        stock_quantity:
          type: integer
        condition:
          type: string
          enum: [new, like_new, used, refurbished]
        is_featured:
          type: boolean
        primary_image:
          type: string
          format: uri
          nullable: true
        seller:
          type: object
          properties:
            id:
              type: integer
            username:
              type: string
            seller_rating:
              type: number
        category:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            slug:
              type: string
        view_count:
          type: integer
        favorite_count:
          type: integer
        average_rating:
          type: number
          nullable: true
        review_count:
          type: integer
        created_at:
          type: string
          format: date-time

    ProductDetail:
      allOf:
        - $ref: '#/components/schemas/ProductList'
        - type: object
          properties:
            description:
              type: string
            brand:
              type: string
            model:
              type: string
            colors:
              type: array
              items:
                type: string
            materials:
              type: string
            dimensions:
              type: object
              properties:
                length:
                  type: number
                width:
                  type: number
                height:
                  type: number
            weight:
              type: number
            tags:
              type: array
              items:
                type: string
            is_digital:
              type: boolean
            images:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                  image_url:
                    type: string
                    format: uri
                  is_primary:
                    type: boolean
                  order:
                    type: integer
            reviews:
              type: array
              items:
                $ref: '#/components/schemas/Review'

    ProductCreate:
      type: object
      required: [name, price, category_id, stock_quantity]
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 255
        description:
          type: string
        short_description:
          type: string
          maxLength: 500
        price:
          type: string
          format: decimal
        original_price:
          type: string
          format: decimal
        category_id:
          type: integer
        stock_quantity:
          type: integer
          minimum: 0
        condition:
          type: string
          enum: [new, like_new, used, refurbished]
          default: new
        brand:
          type: string
        model:
          type: string
        colors:
          type: array
          items:
            type: string
        materials:
          type: string
        tags:
          type: array
          items:
            type: string
        is_digital:
          type: boolean
          default: false
        images:
          type: array
          items:
            type: string
            format: binary

    ProductUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        price:
          type: string
          format: decimal
        stock_quantity:
          type: integer
        is_active:
          type: boolean
        is_featured:
          type: boolean

    # ====================
    # CATEGORY SCHEMAS
    # ====================
    Category:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        slug:
          type: string
        description:
          type: string
        icon:
          type: string
        is_active:
          type: boolean
        product_count:
          type: integer

    # ====================
    # CART SCHEMAS
    # ====================
    Cart:
      type: object
      properties:
        items:
          type: array
          items:
            type: object
            properties:
              product:
                $ref: '#/components/schemas/ProductList'
              quantity:
                type: integer
              subtotal:
                type: string
                format: decimal
        totals:
          type: object
          properties:
            subtotal:
              type: string
              format: decimal
            shipping:
              type: string
              format: decimal
            tax:
              type: string
              format: decimal
            total:
              type: string
              format: decimal
        item_count:
          type: integer

    # ====================
    # ORDER SCHEMAS
    # ====================
    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending_payment, payment_confirmed, awaiting_shipment, shipped, delivered, cancelled, refunded]
        payment_status:
          type: string
          enum: [pending, paid, failed, refunded]
        total_amount:
          type: string
          format: decimal
        created_at:
          type: string
          format: date-time
        item_count:
          type: integer

    OrderDetail:
      allOf:
        - $ref: '#/components/schemas/Order'
        - type: object
          properties:
            buyer:
              type: object
              properties:
                id:
                  type: integer
                username:
                  type: string
                email:
                  type: string
            items:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                  product:
                    $ref: '#/components/schemas/ProductList'
                  quantity:
                    type: integer
                  unit_price:
                    type: string
                    format: decimal
                  total_price:
                    type: string
                    format: decimal
                  product_name:
                    type: string
                  product_image:
                    type: string
                    format: uri
            subtotal:
              type: string
              format: decimal
            shipping_cost:
              type: string
              format: decimal
            tax_amount:
              type: string
              format: decimal
            discount_amount:
              type: string
              format: decimal
            shipping_address:
              type: object
              properties:
                street:
                  type: string
                city:
                  type: string
                state:
                  type: string
                postal_code:
                  type: string
                country:
                  type: string
            buyer_notes:
              type: string
            tracking_number:
              type: string
              nullable: true
            shipping_carrier:
              type: string
              nullable: true
            shipped_at:
              type: string
              format: date-time
              nullable: true
            delivered_at:
              type: string
              format: date-time
              nullable: true

    # ====================
    # REVIEW SCHEMAS
    # ====================
    Review:
      type: object
      properties:
        id:
          type: integer
        product:
          type: object
          properties:
            id:
              type: string
              format: uuid
            name:
              type: string
        reviewer:
          type: object
          properties:
            id:
              type: integer
            username:
              type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5
        title:
          type: string
        comment:
          type: string
        verified_purchase:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ReviewCreate:
      type: object
      required: [product_id, rating]
      properties:
        product_id:
          type: string
          format: uuid
        rating:
          type: integer
          minimum: 1
          maximum: 5
        title:
          type: string
          maxLength: 200
        comment:
          type: string

    # ====================
    # SELLER SCHEMAS
    # ====================
    SellerProfile:
      type: object
      properties:
        id:
          type: integer
        username:
          type: string
        seller_rating:
          type: number
        total_sales:
          type: integer
        products_count:
          type: integer
        joined_date:
          type: string
          format: date
        bio:
          type: string

    # ====================
    # ERROR SCHEMAS
    # ====================
    Error:
      type: object
      properties:
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Human-readable error message
        detail:
          type: string
          description: Detailed error information

    ValidationError:
      type: object
      properties:
        field_name:
          type: array
          items:
            type: string
          description: List of validation errors for each field

  # ====================
  # RESPONSES
  # ====================
  responses:
    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            detail: "Authentication credentials were not provided."

    PermissionDenied:
      description: Permission denied
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            detail: "You do not have permission to perform this action."

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            detail: "Not found."

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationError'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "internal_error"
            message: "An unexpected error occurred."
